

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compte-rendu Extincteurs - MproIntervention</title>
  <style>

.op-item, .dc-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
}
.op-item input,
.dc-item input {
  margin: 0;
}

</style>
</head>
<body>
  <h2>Compte-rendu Extincteurs</h2>
  <div><strong>Client :</strong> Dupont Entreprise</div>
  <div><strong>Lieu dâ€™intervention :</strong> Site Annexe - Zone industrielle</div>
  <div style="margin-top: 30px; margin-bottom: 10px;">
    <div style="display: flex; flex-wrap: wrap; gap: 30px;">
      <div style="flex: 1; min-width: 220px;">
        <label for="date_intervention">ğŸ“… Date dâ€™intervention</label>
        <input type="date" name="date_intervention" id="date_intervention" />
      </div>
      <div style="flex: 2; min-width: 220px;">
        <label for="technicien">ğŸ‘¨â€ğŸ”§ Technicien intervenant</label>
        <input type="text" name="technicien" id="technicien" placeholder="Nom et prÃ©nom du technicien" />
      </div>
    </div>
  </div>

  <section id="extincteurs-container"></section>
  <div style="text-align: left; margin: 20px 0;">
    <button onclick="addExtincteur()" type="button" class="btn">â• Ajouter un extincteur</button>
  </div>

  



<div class="checkbox-group" style="margin-top: 20px;">
  <h3>âœ… Devoir de conseil</h3>
  <div style="display: flex; flex-direction: column; gap: 12px;">
    <label class="dc-item"><input type="checkbox" class="check-dc" id="dc-registre" /> Registre prÃ©sent et Ã  jour</label>
    <label class="dc-item"><input type="checkbox" class="check-dc" id="dc-signaletique" /> SignalÃ©tique Ã  jour</label>
    <label class="dc-item"><input type="checkbox" class="check-dc" id="dc-baes" /> BAES prÃ©sents</label>
    <label class="dc-item"><input type="checkbox" class="check-dc" id="dc-plans" /> Plans de sÃ©curitÃ© prÃ©sents et Ã  jour</label>
  </div>
</div>

</div>

</div>

</div>


  <div style="margin-top: 20px;">
    <button class="btn" onclick="validerCompteRendu()">âœ… Valider le compte rendu</button>
    <button class="btn" style="background:#28a745;margin-left:10px;" onclick="window.location.href='bon.html'">â¡ï¸ Passer au bon dâ€™intervention</button>
  </div>

  <template id="extincteur-template">
    <details open class="extincteur-bloc">
      <summary>Nouvel extincteur</summary>
      <div class="grid">
        <div><label>NÂ° extincteur</label><input class="ext-num" /></div>
        <div><label>Type d'extincteur</label><input class="ext-type" list="types-extincteurs" /></div>
        <div><label>Ext. PP ?</label><input type="checkbox" /></div>
        <div><label>MillÃ©sime</label><input class="ext-year" list="years-list" /></div>
        <div><label>Fabricant</label><input class="ext-fab" list="fabricants" /></div>
        <div><label>Niveau</label><input class="ext-niv" /></div>
        <div><label>Emplacement</label><input class="ext-emplacement" /></div>
        <div style="grid-column: span 2;"><label>OpÃ©rations effectuÃ©es</label>
          





<div class="operations-column" style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
  <label class="op-item"><input type="checkbox" data-code="VF" id="op-vf" /> VÃ©rification OK</label>
  <label class="op-item"><input type="checkbox" data-code="RQ" id="op-rq" /> RÃ©vision quinquennale</label>
  <label class="op-item"><input type="checkbox" data-code="RE" id="op-re" /> RechargÃ©</label>
  <label class="op-item"><input type="checkbox" data-code="MS" id="op-ms" /> Mise en service</label>
  <label class="op-item"><input type="checkbox" data-code="ES" id="op-es" /> Ã‰change standard</label>
</div>






        </div>
        <div style="grid-column: span 2;"><label>Observation</label><textarea rows="3"></textarea></div>
      </div>
      <button class="btn" type="button" onclick="validerExtincteur(this)">âœ… Valider extincteur</button>
    </details>
  </template>

  <datalist id="types-extincteurs">
    <option value="6Kg Poudre ABC" />
    <option value="2Kg CO2" />
    <option value="9L Eau + Additif" />
  </datalist>
  <datalist id="years-list">
    <option value="2025" /><option value="2024" /><option value="2023" />
  </datalist>
  <datalist id="fabricants">
    <option value="Desautel" />
    <option value="Eurofeu" />
    <option value="Andrieu" />
  </datalist>

  <div class="nav-shortcuts">
    <a href="index.html" title="Accueil">ğŸ </a>
    <a href="intervention_extincteurs.html" title="Extincteurs">ğŸ§¯</a>
    <a href="intervention_ria.html" title="RIA">ğŸš¿</a>
    <a href="intervention_baes.html" title="BAES">ğŸ’¡</a>
    <a href="intervention_desenfumage.html" title="DÃ©senfumage">ğŸ’¨</a>
  </div>

  <script>
    let compteur = 1;
    function addExtincteur() {
      const container = document.getElementById("extincteurs-container");
      const template = document.getElementById("extincteur-template");
      const clone = template.content.cloneNode(true);
      clone.querySelector(".ext-num").value = compteur++;
      container.appendChild(clone);
    }

    function validerExtincteur(btn) {
      const bloc = btn.closest("details");
      const num = bloc.querySelector(".ext-num").value.trim();
      const type = bloc.querySelector(".ext-type").value.trim();
      const fab = bloc.querySelector(".ext-fab").value.trim();
      const niv = bloc.querySelector(".ext-niv").value.trim();
      const empl = bloc.querySelector(".ext-emplacement").value.trim();
      const ops = [...bloc.querySelectorAll("input[data-code]:checked")];

      if (!num || !type || !fab || !niv || !empl || ops.length === 0) {
        alert("Merci de remplir les champs obligatoires et cocher au moins une opÃ©ration.");
        return;
      }

      const codeOps = ops.map(x => x.dataset.code).join(", ");
      bloc.querySelector("summary").textContent = `ğŸ§¯ NÂ°${num} â€“ ${type} â€“ ${empl.slice(0, 12)} â€“ ${codeOps}`;
      [...bloc.querySelectorAll("input, textarea")].forEach(el => el.disabled = true);
      btn.style.display = "none";

      const bar = document.createElement("div");
      bar.innerHTML = `
        <button class="btn" onclick="toggleEdit(this)">âœï¸ Modifier</button>
        <button class="btn" style="background:#d9534f;" onclick="supprimerExtincteur(this)">ğŸ—‘ï¸ Supprimer</button>
      `;
      bloc.appendChild(bar);
      bloc.open = false;
    }

    function toggleEdit(btn) {
      const bloc = btn.closest("details");
      [...bloc.querySelectorAll("input, textarea")].forEach(el => el.disabled = false);
      bloc.querySelector("button").style.display = "inline-block";
      bloc.open = true;
    }

    function supprimerExtincteur(btn) {
      if (confirm("Confirmer la suppression de cet extincteur ?")) {
        btn.closest("details").remove();
      }
    }

    function validerCompteRendu() {
      localStorage.removeItem("crm_extincteurs_CLIENT123");
      alert("Compte rendu validÃ© !");
    }

    // Sauvegarde automatique
    setInterval(() => {
      localStorage.setItem("crm_extincteurs_CLIENT123", document.getElementById("extincteurs-container").innerHTML);
    }, 10000);

    window.onload = () => {

    document.querySelectorAll('input[list]').forEach(input => {
      input.addEventListener('focus', () => {
        const listId = input.getAttribute('list');
        if (listId) {
          const datalist = document.getElementById(listId);
          if (datalist && datalist.options.length) {
            input.setAttribute('autocomplete', 'on');
          }
        }
      });
    });

      addExtincteur();
    };
  </script>
</body>
</html>
