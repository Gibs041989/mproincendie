

<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Compte-rendu Extincteurs - MproIntervention</title>
<style>





    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; margin-bottom: 100px; }
    h2 { color: #b30000; }
    label { display: block; font-weight: 600; margin-top: 10px; }
    input, select, textarea {
      font-size: 16px; width: 100%; padding: 8px; margin-top: 4px; border-radius: 4px; border: 1px solid #ccc; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .flex { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
    .btn { margin-top: 20px; padding: 10px 20px; background: #0077cc; color: white; border: none; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #005fa3; }
    .extincteur-bloc { background: white; border: 1px solid #ccc; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
    summary { font-weight: bold; margin-bottom: 10px; cursor: pointer; }
    .checkbox-group { background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ccc; margin-top: 20px; }
    .nav-shortcuts { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: center; gap: 30px; border-top: 1px solid #ccc; padding: 12px 0; font-size: 1.8rem; z-index: 999; }
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: 1fr !important;
      }
    }
  

.op-item, .dc-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
  width: 100%;
  box-sizing: border-box;
}
.op-item input, .dc-item input {
  margin: 0;
}



.op-item, .dc-item {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  text-align: left;
  gap: 12px;
  padding: 12px;
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
  width: fit-content;
  max-width: 100%;
  box-sizing: border-box;
}
.op-item input, .dc-item input {
  margin: 0;
}



.op-item, .dc-item {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  text-align: left;
  gap: 12px;
  padding: 12px;
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
  min-width: 320px;
  max-width: 100%;
  white-space: nowrap;
  box-sizing: border-box;
}
.op-item input, .dc-item input {
  margin: 0;
}



.op-item, .dc-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  text-align: left;
  gap: 12px;
  padding: 12px;
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 8px;
  cursor: pointer;
  min-width: 320px;
  max-width: 100%;
  white-space: nowrap;
  box-sizing: border-box;
}
.op-item input, .dc-item input {
  margin: 0;
}



body {
  font-size: 16px;
}
input, select, textarea {
  font-size: 1rem;
  padding: 10px;
}
button {
  font-size: 1rem;
  padding: 10px 16px;
}
label {
  font-weight: 600;
}


/* GLOBAL */
:root {
  --main-color: #b30000;
  --bg-light: #f5f5f5;
  --btn-color: #0077cc;
  --btn-hover: #005fa3;
}
body {
  max-width: 960px;
  margin: 0 auto;
}
h2 span {
  font-size: 1.6rem;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 15px;
}
textarea {
  resize: vertical;
}
button.btn {
  width: 100%;
  max-width: 260px;
}
@media (max-width: 768px) {
  h2 span {
    font-size: 1.4rem;
  }
  .nav-shortcuts {
    font-size: 1.5rem;
    gap: 20px;
    padding: 10px 0;
  }
}

input, select, textarea {
  width: 100% !important;
  box-sizing: border-box;
  display: block;
}
textarea {
  min-height: 100px;
}
.grid > div {
  width: 100%;
}
</style>
</head>
<body>
<h2><span style="font-size: 1.4rem; font-weight: 700;">Compte-rendu Extincteurs</span></h2>
<div><strong>Client :</strong> Dupont Entreprise</div>
<div><strong>Lieu d’intervention :</strong> Site Annexe - Zone industrielle</div>
<div style="margin-top: 30px; margin-bottom: 10px;">
<div style="display: flex; flex-wrap: wrap; gap: 30px;">
<div style="flex: 1; min-width: 220px;">
<label for="date_intervention">📅 Date d’intervention</label>
<input id="date_intervention" name="date_intervention" type="date"/>
</div>
<div style="flex: 2; min-width: 220px;">
<label for="technicien">👨‍🔧 Technicien intervenant</label>
<input id="technicien" name="technicien" placeholder="Nom et prénom du technicien" type="text"/>
</div>
</div>
</div>
<section id="extincteurs-container"></section>
<div style="text-align: left; margin: 20px 0;">
<button class="btn" onclick="addExtincteur()" type="button">➕ Ajouter un extincteur</button>
</div>
<div class="checkbox-group" style="margin-top: 20px;">
<h3><span style="font-size: 1.2rem; font-weight: 600;">✅ Devoir de conseil</span></h3>
<div style="display: flex; flex-direction: column; gap: 12px;">
<label class="dc-item">Registre présent et à jour<input class="check-dc" id="dc-registre" type="checkbox"/></label>
<label class="dc-item">Signalétique à jour<input class="check-dc" id="dc-signaletique" type="checkbox"/></label>
<label class="dc-item">BAES présents<input class="check-dc" id="dc-baes" type="checkbox"/></label>
<label class="dc-item">Plans de sécurité présents et à jour<input class="check-dc" id="dc-plans" type="checkbox"/></label>
</div>
</div>
<div style="margin-top: 20px;">
<button class="btn" onclick="validerCompteRendu()">✅ Valider le compte rendu</button>
<button class="btn" onclick="window.location.href='bon.html'" style="background:#28a745;margin-left:10px;">➡️ Passer au bon d’intervention</button>
</div>
<template id="extincteur-template">
<details class="extincteur-bloc" open="">
<summary style="font-weight: bold; font-size: 1.15rem;">🧯 Nouvel extincteur</summary>
<div class="grid" style="display: flex; flex-direction: column; gap: 15px;">
<div><label>N° extincteur</label><input class="ext-num"/></div>
<div><label>Type d'extincteur</label><input class="ext-type" list="types-extincteurs"/></div>
<div><label class="op-item" style="width: 100%; justify-content: space-between;">Ext. PP ?<input class="ext-pp" type="checkbox"/></label></div>
<div><label>Fabricant</label><input class="ext-fab" list="fabricants"/></div>
<div><label>Millésime</label><input class="ext-year" list="years-list"/></div>
<div><label>Niveau</label><input class="ext-niv"/></div>
<div><label>Emplacement</label><input class="ext-emplacement"/></div>
</div>
<div style="grid-column: span 2;">
<h4 style="font-size: 1.1rem; color: #b30000; font-weight: 600; margin-top: 20px;">Opérations effectuées</h4>
<div class="operations-column" style="display: flex; flex-direction: column; gap: 12px; margin-top: 10px;">
<label class="op-item">Vérification OK<input data-code="VF" id="op-vf" type="checkbox"/></label>
<label class="op-item">Révision quinquennale<input data-code="RQ" id="op-rq" type="checkbox"/></label>
<label class="op-item">Rechargé<input data-code="RE" id="op-re" type="checkbox"/></label>
<label class="op-item">Mise en service<input data-code="MS" id="op-ms" type="checkbox"/></label>
<label class="op-item">Échange standard<input data-code="ES" id="op-es" type="checkbox"/></label>
</div>
</div>
<div style="grid-column: span 2;">
<h4 style="font-size: 1.1rem; color: #b30000; font-weight: 600; margin-top: 20px;">Observation</h4>
<textarea rows="3"></textarea>
</div>
<button class="btn" onclick="validerExtincteur(this)" type="button">✅ Valider extincteur</button>
</details>
</template>
<datalist id="types-extincteurs">
<option value="6Kg Poudre ABC"></option>
<option value="2Kg CO2"></option>
<option value="9L Eau + Additif"></option>
</datalist>
<datalist id="years-list">
<option value="2025"></option><option value="2024"></option><option value="2023"></option>
</datalist>
<datalist id="fabricants">
<option value="Desautel"></option>
<option value="Eurofeu"></option>
<option value="Andrieu"></option>
</datalist>
<div class="nav-shortcuts">
<a href="index.html" title="Accueil">🏠</a>
<a href="intervention_extincteurs.html" title="Extincteurs">🧯</a>
<a href="intervention_ria.html" title="RIA">🚿</a>
<a href="intervention_baes.html" title="BAES">💡</a>
<a href="intervention_desenfumage.html" title="Désenfumage">💨</a>
</div>
<script>
    let compteur = 1;
    function addExtincteur() {
      const container = document.getElementById("extincteurs-container");
      const template = document.getElementById("extincteur-template");
      const clone = template.content.cloneNode(true);
      clone.querySelector(".ext-num").value = compteur++;
      container.appendChild(clone);
    }

    function validerExtincteur(btn) {
      const bloc = btn.closest("details");
      const num = bloc.querySelector(".ext-num").value.trim();
      const type = bloc.querySelector(".ext-type").value.trim();
      const fab = bloc.querySelector(".ext-fab").value.trim();
      const niv = bloc.querySelector(".ext-niv").value.trim();
      const empl = bloc.querySelector(".ext-emplacement").value.trim();
      const ops = [...bloc.querySelectorAll("input[data-code]:checked")];

      if (!num || !type || !niv || !empl || ops.length === 0) {
        alert("Merci de remplir les champs obligatoires et cocher au moins une opération.");
        return;
      }

      const codeOps = ops.map(x => x.dataset.code).join(", ");
      bloc.querySelector("summary").textContent = `🧯 N°${num} – ${type} – ${empl.slice(0, 12)} – ${codeOps}`;
      [...bloc.querySelectorAll("input, textarea")].forEach(el => el.disabled = true);
      btn.style.display = "none";

      const bar = document.createElement("div");
      bar.innerHTML = `
        <button class="btn" onclick="toggleEdit(this)">✏️ Modifier</button>
        <button class="btn" style="background:#d9534f;" onclick="supprimerExtincteur(this)">🗑️ Supprimer</button>
      `;
      bloc.appendChild(bar);
      bloc.open = false;
    }

    function toggleEdit(btn) {
      const bloc = btn.closest("details");
      [...bloc.querySelectorAll("input, textarea")].forEach(el => el.disabled = false);
      bloc.querySelector("button").style.display = "inline-block";
      bloc.open = true;
    }

    function supprimerExtincteur(btn) {
      if (confirm("Confirmer la suppression de cet extincteur ?")) {
        btn.closest("details").remove();
      }
    }

    
function validerCompteRendu() {
  const extincteurs = document.querySelectorAll('.extincteur-bloc');
  if (extincteurs.length === 0) {
    alert("Vous devez renseigner au moins un extincteur pour valider le compte rendu.");
    return;
  }

  const nb = extincteurs.length;
  if (!confirm("Confirmer la validation pour " + nb + " extincteur(s) renseigné(s) ?")) {
    return;
  }

  localStorage.removeItem("crm_extincteurs_CLIENT123");
  alert("Compte rendu validé !");
}


    // Sauvegarde automatique
    setInterval(() => {
      localStorage.setItem("crm_extincteurs_CLIENT123", document.getElementById("extincteurs-container").innerHTML);
    }, 10000);

    window.onload = () => {

    document.querySelectorAll('input[list]').forEach(input => {
      input.addEventListener('focus', () => {
        const listId = input.getAttribute('list');
        if (listId) {
          const datalist = document.getElementById(listId);
          if (datalist && datalist.options.length) {
            input.setAttribute('autocomplete', 'on');
          }
        }
      });
    });

      addExtincteur();
    };
  </script>
</body>
</html>
