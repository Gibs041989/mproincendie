

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compte-rendu Extincteurs - MproIntervention</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; padding: 20px; margin-bottom: 100px; }
    h2 { color: #b30000; }
    label { display: block; font-weight: 600; margin-top: 10px; }
    input, select, textarea {
      font-size: 16px; width: 100%; padding: 8px; margin-top: 4px; border-radius: 4px; border: 1px solid #ccc; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .flex { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px; }
    .btn { margin-top: 20px; padding: 10px 20px; background: #0077cc; color: white; border: none; border-radius: 6px; cursor: pointer; }
    .btn:hover { background: #005fa3; }
    .extincteur-bloc { background: white; border: 1px solid #ccc; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
    summary { font-weight: bold; margin-bottom: 10px; cursor: pointer; }
    .checkbox-group { background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ccc; margin-top: 20px; }
    .nav-shortcuts { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: center; gap: 30px; border-top: 1px solid #ccc; padding: 12px 0; font-size: 1.8rem; z-index: 999; }
    @media (max-width: 600px) {
      .grid {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>
  <h2>Compte-rendu Extincteurs</h2>
  <div><strong>Client :</strong> Dupont Entreprise</div>
  <div><strong>Lieu d’intervention :</strong> Site Annexe - Zone industrielle</div>
  <div style="margin-top: 30px; margin-bottom: 10px;">
    <div style="display: flex; flex-wrap: wrap; gap: 30px;">
      <div style="flex: 1; min-width: 220px;">
        <label for="date_intervention">📅 Date d’intervention</label>
        <input type="date" name="date_intervention" id="date_intervention" />
      </div>
      <div style="flex: 2; min-width: 220px;">
        <label for="technicien">👨‍🔧 Technicien intervenant</label>
        <input type="text" name="technicien" id="technicien" placeholder="Nom et prénom du technicien" />
      </div>
    </div>
  </div>

  <section id="extincteurs-container"></section>
  <div style="text-align: left; margin: 20px 0;">
    <button onclick="addExtincteur()" type="button" class="btn">➕ Ajouter un extincteur</button>
  </div>

  <div class="checkbox-group">
    <h3>✅ Devoir de conseil</h3>
    <label><input type="checkbox" class="check-dc" /> Registre présent et à jour</label>
    <label><input type="checkbox" class="check-dc" /> Signalétique à jour</label>
    <label><input type="checkbox" class="check-dc" /> BAES présents</label>
    <label><input type="checkbox" class="check-dc" /> Plans de sécurité présents et à jour</label>
  </div>

  <div style="margin-top: 20px;">
    <button class="btn" onclick="validerCompteRendu()">✅ Valider le compte rendu</button>
    <button class="btn" style="background:#28a745;margin-left:10px;" onclick="window.location.href='bon.html'">➡️ Passer au bon d’intervention</button>
  </div>

  <template id="extincteur-template">
    <details open class="extincteur-bloc">
      <summary>Nouvel extincteur</summary>
      <div class="grid">
        <div><label>N° extincteur</label><input class="ext-num" /></div>
        <div><label>Type d'extincteur</label><input class="ext-type" list="types-extincteurs" /></div>
        <div><label>Ext. PP ?</label><input type="checkbox" /></div>
        <div><label>Millésime</label><input class="ext-year" list="years-list" /></div>
        <div><label>Fabricant</label><input class="ext-fab" list="fabricants" /></div>
        <div><label>Niveau</label><input class="ext-niv" /></div>
        <div><label>Emplacement</label><input class="ext-emplacement" /></div>
        <div style="grid-column: span 2;"><label>Opérations effectuées</label>
          

<div class="operations-column" style="display: grid; grid-template-columns: auto 1fr; row-gap: 10px; align-items: center; margin-top: 10px;">
  <input type="checkbox" data-code="VF" id="op-vf" />
  <label for="op-vf">Vérification OK</label>

  <input type="checkbox" data-code="RQ" id="op-rq" />
  <label for="op-rq">Révision quinquennale</label>

  <input type="checkbox" data-code="RE" id="op-re" />
  <label for="op-re">Rechargé</label>

  <input type="checkbox" data-code="MS" id="op-ms" />
  <label for="op-ms">Mise en service</label>

  <input type="checkbox" data-code="ES" id="op-es" />
  <label for="op-es">Échange standard</label>
</div>


        </div>
        <div style="grid-column: span 2;"><label>Observation</label><textarea rows="3"></textarea></div>
      </div>
      <button class="btn" type="button" onclick="validerExtincteur(this)">✅ Valider extincteur</button>
    </details>
  </template>

  <datalist id="types-extincteurs">
    <option value="6Kg Poudre ABC" />
    <option value="2Kg CO2" />
    <option value="9L Eau + Additif" />
  </datalist>
  <datalist id="years-list">
    <option value="2025" /><option value="2024" /><option value="2023" />
  </datalist>
  <datalist id="fabricants">
    <option value="Desautel" />
    <option value="Eurofeu" />
    <option value="Andrieu" />
  </datalist>

  <div class="nav-shortcuts">
    <a href="index.html" title="Accueil">🏠</a>
    <a href="intervention_extincteurs.html" title="Extincteurs">🧯</a>
    <a href="intervention_ria.html" title="RIA">🚿</a>
    <a href="intervention_baes.html" title="BAES">💡</a>
    <a href="intervention_desenfumage.html" title="Désenfumage">💨</a>
  </div>

  <script>
    let compteur = 1;
    function addExtincteur() {
      const container = document.getElementById("extincteurs-container");
      const template = document.getElementById("extincteur-template");
      const clone = template.content.cloneNode(true);
      clone.querySelector(".ext-num").value = compteur++;
      container.appendChild(clone);
    }

    function validerExtincteur(btn) {
      const bloc = btn.closest("details");
      const num = bloc.querySelector(".ext-num").value.trim();
      const type = bloc.querySelector(".ext-type").value.trim();
      const fab = bloc.querySelector(".ext-fab").value.trim();
      const niv = bloc.querySelector(".ext-niv").value.trim();
      const empl = bloc.querySelector(".ext-emplacement").value.trim();
      const ops = [...bloc.querySelectorAll("input[data-code]:checked")];

      if (!num || !type || !fab || !niv || !empl || ops.length === 0) {
        alert("Merci de remplir les champs obligatoires et cocher au moins une opération.");
        return;
      }

      const codeOps = ops.map(x => x.dataset.code).join(", ");
      bloc.querySelector("summary").textContent = `🧯 N°${num} – ${type} – ${empl.slice(0, 12)} – ${codeOps}`;
      [...bloc.querySelectorAll("input, textarea")].forEach(el => el.disabled = true);
      btn.style.display = "none";

      const bar = document.createElement("div");
      bar.innerHTML = `
        <button class="btn" onclick="toggleEdit(this)">✏️ Modifier</button>
        <button class="btn" style="background:#d9534f;" onclick="supprimerExtincteur(this)">🗑️ Supprimer</button>
      `;
      bloc.appendChild(bar);
      bloc.open = false;
    }

    function toggleEdit(btn) {
      const bloc = btn.closest("details");
      [...bloc.querySelectorAll("input, textarea")].forEach(el => el.disabled = false);
      bloc.querySelector("button").style.display = "inline-block";
      bloc.open = true;
    }

    function supprimerExtincteur(btn) {
      if (confirm("Confirmer la suppression de cet extincteur ?")) {
        btn.closest("details").remove();
      }
    }

    function validerCompteRendu() {
      localStorage.removeItem("crm_extincteurs_CLIENT123");
      alert("Compte rendu validé !");
    }

    // Sauvegarde automatique
    setInterval(() => {
      localStorage.setItem("crm_extincteurs_CLIENT123", document.getElementById("extincteurs-container").innerHTML);
    }, 10000);

    window.onload = () => {

    document.querySelectorAll('input[list]').forEach(input => {
      input.addEventListener('focus', () => {
        const listId = input.getAttribute('list');
        if (listId) {
          const datalist = document.getElementById(listId);
          if (datalist && datalist.options.length) {
            input.setAttribute('autocomplete', 'on');
          }
        }
      });
    });

      addExtincteur();
    };
  </script>
</body>
</html>
