
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compte rendu - Mproincendie</title>
  
<style>
:root {
  --red: #cc0000;
  --light-bg: #f9f9f9;
  --gray: #ddd;
}

    
body {
  font-family: 'Segoe UI', sans-serif;
  background: var(--light-bg);
  padding: 30px;
  color: #222;
 padding: 20px; background: #f4f4f4; max-width: 1000px; margin: auto; }
    h1 { color: #cc0000; }
    fieldset { margin-bottom: 30px; background: #fff; padding: 20px; border-radius: 8px; border: 1px solid var(--gray); }
    legend { font-weight: bold; font-size: 1.2rem; color: var(--red); padding: 0 10px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { border: 1px solid #bbb; border-radius: 4px; width: 100%; padding: 8px; margin-top: 4px; }
    .extincteur { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: white; position: relative; }
    .extincteur button { margin-right: 10px; }
    .signature-pad { border: 1px solid #999; width: 100%; height: 150px; }
    .extincteur-actions { margin-top: 10px; }
  </style>
</head>
<body>

<h1>üîß Compte Rendu de Maintenance</h1>

<form onsubmit="event.preventDefault(); alert('Compte rendu enregistr√© (simulation)')">

  <fieldset>
    <legend>Informations g√©n√©rales</legend>
    <label>Num√©ro d'intervention :
      <input type="text" id="interventionId" readonly>
    </label>
    
<label>Nom du client :
  <input type="text" id="clientName" required>
  <button type="button" onclick="selectionnerClient()">üìÅ S√©lectionner depuis la base</button>
</label>

    <label>Adresse de facturation : <input type="text"></label>
    <label>Adresse d'intervention (si diff√©rente) : <input type="text" placeholder="B√¢timent, √©tage, zone..."></label>
    <label>Contact : <input type="text"></label>
    <label>T√©l√©phone : <input type="text"></label>
    <label>Email : <input type="email"></label>
    <label>Technicien :
      <select id="technicienSelect"></select>
    </label>
  </fieldset>

  <fieldset>
    <legend>Intervention</legend>
    <label>Date : <input type="date"></label>
    <label>Heure de d√©but : <input type="time"></label>
    
    <label>Type d'intervention :
      <select id="prestationSelect"></select>
    </label>
  </fieldset>

  <fieldset>
    <legend>Extincteurs (<span id="extCount">0</span>)</legend>
    <div id="extincteurs"></div>
    <button type="button" onclick="ajouterExtincteur()">+ Ajouter un extincteur</button>
  </fieldset>

  <fieldset>
    <legend>Pi√®ces jointes et checklist</legend>
    <label>Ajouter photo(s) : <input type="file" accept="image/*" multiple></label>
    <label>Observations globales : <textarea rows="3"></textarea></label>

<div class="checklist">
  <div style="display: flex; font-weight: bold; margin-bottom: 5px;">
    <div style="flex: 2;"></div>
    <div style="flex: 1; text-align: center;">Oui</div>
    <div style="flex: 1; text-align: center;">Non</div>
  </div>
  <div style="display: flex; align-items: center; margin-bottom: 8px;">
    <div style="flex: 2;">Registre de s√©curit√© pr√©sent et √† jour ?</div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
  </div>
  <div style="display: flex; align-items: center; margin-bottom: 8px;">
    <div style="flex: 2;">Signal√©tique en place ?</div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
  </div>
  <div style="display: flex; align-items: center; margin-bottom: 8px;">
    <div style="flex: 2;">BAES pr√©sents ?</div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
  </div>
  <div style="display: flex; align-items: center;">
    <div style="flex: 2;">Plans √† jour ?</div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
    <div style="flex: 1; text-align: center;"><input type="checkbox"></div>
  </div>
</div>

    
    
    
  </fieldset>

  <fieldset>
    <legend>Signatures</legend>
    <label>Nom du signataire (client) : <input type="text"></label>
    <label>Signature client :</label>
    <canvas class="signature-pad" id="signClient"></canvas>
    <label>Nom du technicien : <input type="text" id="signTechName"></label>
<label>Heure de fin d‚Äôintervention : <input type="time" id="endTime"></label>
    <label>Signature technicien :</label>
    <canvas class="signature-pad" id="signTech"></canvas>
  </fieldset>

  <button type="submit">Valider le compte rendu</button>
  <a href="index.html" style="display:block;margin-top:20px;">‚¨Ö Retour √† l‚Äôaccueil</a>
</form>

<script>
let extincteurCount = 0;
const yearOptions = `<option value="1995">1995</option><option value="1996">1996</option><option value="1997">1997</option><option value="1998">1998</option><option value="1999">1999</option><option value="2000">2000</option><option value="2001">2001</option><option value="2002">2002</option><option value="2003">2003</option><option value="2004">2004</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option><option value="2009">2009</option><option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018">2018</option><option value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option><option value="2032">2032</option><option value="2033">2033</option><option value="2034">2034</option><option value="2035">2035</option><option value="2036">2036</option><option value="2037">2037</option><option value="2038">2038</option><option value="2039">2039</option><option value="2040">2040</option><option value="2041">2041</option><option value="2042">2042</option><option value="2043">2043</option><option value="2044">2044</option><option value="2045">2045</option><option value="2046">2046</option><option value="2047">2047</option><option value="2048">2048</option><option value="2049">2049</option><option value="2050">2050</option><option value="2051">2051</option><option value="2052">2052</option><option value="2053">2053</option><option value="2054">2054</option><option value="2055">2055</option>`;

function chargerListes() {
  const prestations = JSON.parse(localStorage.getItem('prestations') || '[]');
  const techniciens = JSON.parse(localStorage.getItem('techniciens') || '[]');
  const types = JSON.parse(localStorage.getItem('types') || '[]');
  const fabricants = JSON.parse(localStorage.getItem('fabricants') || '[]');

  let pSel = document.getElementById('prestationSelect');
  prestations.forEach(function(p) {
    let opt = document.createElement('option');
    opt.value = opt.text = p;
    pSel.appendChild(opt);
  });

  let tSel = document.getElementById('technicienSelect');
  techniciens.forEach(function(t) {
    let opt = document.createElement('option');
    opt.value = opt.text = t;
    tSel.appendChild(opt);
  });

  window.options = { types: types, prestations: prestations, fabricants: fabricants };
}

function ajouterExtincteur() {
  extincteurCount++;
  document.getElementById('extCount').textContent = extincteurCount;

  const container = document.getElementById('extincteurs');
  const div = document.createElement('div');
  div.className = 'extincteur';

  let fabOpt = window.options.fabricants.map(f => `<option>${f}</option>`).join('');
  let typeOpt = window.options.types.map(t => `<option>${t}</option>`).join('');
  let ops = window.options.prestations.map(p => `<label><input type="checkbox"> ${p}</label>`).join('');

  div.innerHTML = `
    <label>N¬∞ Extincteur : <input type="text"></label>
    
    <label>Type :
      <select>${typeOpt}</select>
    </label>
    <label>Pression Permanente (PP) : <input type="checkbox"></label>
    <label>Mise en service :
      <select><option value="1995">1995</option><option value="1996">1996</option><option value="1997">1997</option><option value="1998">1998</option><option value="1999">1999</option><option value="2000">2000</option><option value="2001">2001</option><option value="2002">2002</option><option value="2003">2003</option><option value="2004">2004</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option><option value="2009">2009</option><option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018">2018</option><option value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option><option value="2032">2032</option><option value="2033">2033</option><option value="2034">2034</option><option value="2035">2035</option><option value="2036">2036</option><option value="2037">2037</option><option value="2038">2038</option><option value="2039">2039</option><option value="2040">2040</option><option value="2041">2041</option><option value="2042">2042</option><option value="2043">2043</option><option value="2044">2044</option><option value="2045">2045</option><option value="2046">2046</option><option value="2047">2047</option><option value="2048">2048</option><option value="2049">2049</option><option value="2050">2050</option><option value="2051">2051</option><option value="2052">2052</option><option value="2053">2053</option><option value="2054">2054</option><option value="2055">2055</option></select>
    </label>
    <label>Fabricant :
  <select onchange="if(this.value==='__new__'){this.previousElementSibling.value=prompt('Nom ?') || '';}">
    ${fabOpt}
    <option value="__new__">+ Ajouter</option>
  </select>
</label>
<label>Emplacement : <input type="text"></label>
    <label>Op√©rations :</label>
    ${ops}
    <label>Observations : <textarea rows="2"></textarea></label>
    <div class="extincteur-actions">
      <button type="button" onclick="this.closest('.extincteur').remove(); extincteurCount--; document.getElementById('extCount').textContent = extincteurCount;">‚ùå Supprimer</button>
      <button type="button" onclick="ajouterExtincteur()">‚ôªÔ∏è Remplacer</button>
    </div>
  `;
  container.appendChild(div);
}

function genererId() {
  const d = new Date();
  const y = d.getFullYear().toString().slice(-2);
  const m = String(d.getMonth()+1).padStart(2, '0');
  const random = Math.floor(Math.random() * 9000 + 1000);
  document.getElementById('interventionId').value = `IT${y}{m}-${random}`;
}

chargerListes();

genererId();
document.querySelector('form').addEventListener('submit', function() {
  const now = new Date();
  const hh = String(now.getHours()).padStart(2, '0');
  const mm = String(now.getMinutes()).padStart(2, '0');
  document.getElementById('endTime').value = `${hh}:${mm}`;
});
document.getElementById('technicienSelect').addEventListener('change', function() {
  document.getElementById('signTechName').value = this.value;
});


function selectionnerClient() {
  // Simuler une base locale pour l'instant
  const clients = JSON.parse(localStorage.getItem('clients') || '["Client A", "Client B", "Client C"]');
  const nom = prompt("Choisir un client :\n" + clients.join("\n"));
  if (nom) document.getElementById('clientName').value = nom;
}
</script>


</body>
</html>
