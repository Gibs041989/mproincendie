
<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Bon d‚Äôintervention - Mendes Protection Incendie</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
</head>
<body class="min-h-screen bg-gray-100 text-gray-800 pb-24">
<header class="bg-white shadow p-4">
<h1 class="text-xl font-bold text-red-700">üßæ Bon d‚Äôintervention</h1>
<div class="mt-2 text-sm space-y-1" id="client-coordonnees"></div>
<div class="mt-3 text-sm bg-blue-50 border-l-4 border-blue-500 p-2" id="crm-resume"></div>
</header>
<div class="bg-white p-4 shadow rounded mb-4" id="bandeau-client">
<p class="text-sm text-gray-700"><strong>üßæ Client :</strong> <span id="nom-client">[Nom client]</span></p>
<p class="text-sm text-gray-700"><strong>üìç Lieu d‚Äôintervention :</strong> <span id="lieu-intervention">[Lieu d‚Äôintervention]</span></p>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const nom = localStorage.getItem("nom_client");
    const lieu = localStorage.getItem("lieu_intervention");
    const elNom = document.getElementById("nom-client");
    const elLieu = document.getElementById("lieu-intervention");

    if (nom) {
      elNom.textContent = nom;
    } else {
      elNom.textContent = "‚ùå Aucune information client re√ßue";
      elNom.classList.add("text-red-600", "font-semibold");
    }

    if (lieu) {
      elLieu.textContent = lieu;
    } else {
      elLieu.textContent = "‚ùå Aucun lieu d‚Äôintervention pr√©cis√©";
      elLieu.classList.add("text-red-600", "font-semibold");
    }
  });
</script>

<main class="p-4 space-y-6">
<section class="bg-white p-4 shadow rounded-xl">
<h2 class="text-lg font-semibold mb-2">üì¶ Prestations &amp; mat√©riel</h2>
<table class="w-full text-sm border">
<thead class="bg-gray-200 text-left">
<tr>
<th class="p-2">Code article</th>
<th class="p-2">D√©signation</th>
<th class="p-2 text-right">Qt√©</th>
<th class="p-2 text-right">PU ‚Ç¨</th>
<th class="p-2 text-right">Total ‚Ç¨</th>
</tr>
</thead>
<tbody class="divide-y" id="tableau-lignes"></tbody>
</table>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mt-4">
<div>
<label class="block mb-1 text-gray-600">Montant total HT</label>
<input class="w-full border p-2 rounded text-right" id="montant-ht" placeholder="‚Ç¨" readonly=""/>
</div>
<div>
<label class="block mb-1 text-gray-600">Montant TTC</label>
<input class="w-full border p-2 rounded text-right" id="montant-ttc" placeholder="‚Ç¨" readonly=""/>
</div>
</div>
<button class="mt-3 text-sm text-blue-600 underline" onclick="ajouterLigne()">‚ûï Ajouter une ligne</button>
</section>
<section class="bg-white p-4 shadow rounded-xl">
<h2 class="text-lg font-semibold mb-2">‚öôÔ∏è Modalit√©s de r√®glement</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
<div>
<label class="block mb-1 text-gray-600">Mode de paiement</label>
<select class="w-full border p-2 rounded" id="mode-paiement">
<option>Virement</option>
<option>Ch√®que</option>
<option>Carte bancaire</option>
<option>Esp√®ces</option>
</select>
</div>
<div>
<label class="block mb-1 text-gray-600">D√©lai de paiement</label>
<select class="w-full border p-2 rounded" id="delai-paiement">
<option>A r√©ception</option>
<option>30 jours</option>
<option>Fin de mois</option>
</select>
</div>
<div>
<label class="block mb-1 text-gray-600">Montant total HT</label>
<input class="w-full border p-2 rounded text-right" id="montant-ht" placeholder="‚Ç¨" readonly=""/>
</div>
<div>
<label class="block mb-1 text-gray-600">Montant TTC</label>
<input class="w-full border p-2 rounded text-right" id="montant-ttc" placeholder="‚Ç¨" readonly=""/>
</div>
</div>
</section>
<section class="bg-white p-4 shadow rounded-xl">
<h2 class="text-lg font-semibold mb-2">‚úçÔ∏è Signatures</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
<div>
<label class="block mb-1">Nom du client signataire</label>
<input class="w-full p-2 border rounded" id="nom-client"/>
<p class="mt-2 italic">Fait √† <span id="lieu-signature"></span>, le <span id="date-signature"></span></p>
<textarea class="w-full h-24 border border-dashed p-2 text-sm text-gray-700" placeholder="Signature manuscrite ou note client..."></textarea>
</div>
<div>
<label class="block mb-1">Nom du technicien</label>
<input class="w-full p-2 border rounded" id="nom-tech"/>
<p class="mt-5 text-transparent">_</p>
<textarea class="w-full h-24 border border-dashed p-2 text-sm text-gray-700" placeholder="Signature manuscrite ou note client..."></textarea>
</div>
</div>
</section>
<section class="bg-white p-4 shadow rounded-xl mt-6">
<button class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-lg" id="generer-pdf" onclick="genererPDF()">üìÑ G√©n√©rer le PDF</button>
</section>

<section class="bg-white p-4 shadow rounded-xl mt-6">
<h2 class="text-lg font-semibold mb-2">‚úçÔ∏è Signatures</h2>
<p class="text-sm mb-4">Fait √† <span id="ville-signature">[ville]</span>, le <span id="date-signature"></span></p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
<div>
<label class="block text-sm mb-1">Nom du client</label>
<input class="w-full border p-2 rounded mb-2" id="nom-client-signature" readonly=""/>
<canvas class="border rounded w-full h-32 bg-gray-50" id="signature-client"></canvas>
</div>
<div>
<label class="block text-sm mb-1">Nom du technicien</label>
<input class="w-full border p-2 rounded mb-2" id="nom-tech" readonly=""/>
<canvas class="border rounded w-full h-32 bg-gray-50" id="signature-tech"></canvas>
</div>
</div>
</section>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const nom = localStorage.getItem("nom_client") || "";
    const lieu = localStorage.getItem("lieu_intervention") || "";
    const tech = localStorage.getItem("nom_technicien") || "Technicien MPRO";

    // Champs
    document.getElementById("nom-client-signature").value = nom;
    document.getElementById("nom-tech").value = tech;
    document.getElementById("ville-signature").textContent = lieu || "Lieu non pr√©cis√©";
    document.getElementById("date-signature").textContent = new Date().toLocaleDateString("fr-FR");

    // Signatures
    new SignaturePad(document.getElementById("signature-client"));
    new SignaturePad(document.getElementById("signature-tech"));
  });
</script>
</main>
<footer class="fixed bottom-0 left-0 right-0 bg-white border-t shadow flex justify-around p-3 text-xs z-50">
<a class="flex flex-col items-center gap-1" href="index.html">
<span class="text-xl">üè†</span>
<span>Accueil</span>
</a>
<a class="flex flex-col items-center gap-1" href="clients.html">
<span class="text-xl">üìÅ</span>
<span>Clients</span>
</a>
<a class="flex flex-col items-center gap-1" href="intervention.html">
<span class="text-xl">üõ†Ô∏è</span>
<span>Intervention</span>
</a>
</footer>

<script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  // Coordonn√©es client
  const client = localStorage.getItem("nom_client") || "Client inconnu";
  const lieu = localStorage.getItem("lieu_intervention") || "Lieu non pr√©cis√©";
  document.getElementById("client-coordonnees").innerHTML = `
    <strong>üßæ Client :</strong> ${client}<br>
    <strong>üìç Lieu d‚Äôintervention :</strong> ${lieu}
  `;

  // R√©sum√© CRM simul√© depuis stockage
  const resumeCRM = localStorage.getItem("crm_extincteurs_CLIENT123");
  if (resumeCRM) {
    const extrait = new DOMParser().parseFromString(resumeCRM, "text/html");
    const blocs = extrait.querySelectorAll("details summary");
    const lignes = [...blocs].map(b => `<li>${b.textContent}</li>`).join("");
    document.getElementById("crm-resume").innerHTML = `
      <p class="font-semibold mb-1">R√©sum√© du compte-rendu :</p>
      <ul class="list-disc ml-6">${lignes}</ul>
    `;
  }

  // Calcul des totaux
  window.ajouterLigne = function () {
    const tbody = document.getElementById("tableau-lignes");
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="p-1"><input class="w-full p-1 border rounded text-xs" placeholder="Code"></td>
      <td class="p-1"><input class="w-full p-1 border rounded text-xs" placeholder="D√©signation"></td>
      <td class="p-1 text-right"><input class="w-full p-1 border rounded text-xs text-right" type="number" value="1" min="1" onchange="recalculerTotal()"></td>
      <td class="p-1 text-right"><input class="w-full p-1 border rounded text-xs text-right" type="number" value="0" min="0" onchange="recalculerTotal()"></td>
      <td class="p-1 text-right total-ht">0 ‚Ç¨</td>
    `;
    tbody.appendChild(tr);
    recalculerTotal();
  };

  window.recalculerTotal = function () {
    const rows = document.querySelectorAll("#tableau-lignes tr");
    let totalHT = 0;
    rows.forEach(row => {
      const qty = parseFloat(row.cells[2].querySelector("input").value || 0);
      const pu = parseFloat(row.cells[3].querySelector("input").value || 0);
      const lineTotal = qty * pu;
      totalHT += lineTotal;
      row.cells[4].textContent = `${lineTotal.toFixed(2)} ‚Ç¨`;
    });
    document.getElementById("montant-ht").value = `${totalHT.toFixed(2)} ‚Ç¨`;
    document.getElementById("montant-ttc").value = `${(totalHT * 1.2).toFixed(2)} ‚Ç¨`;
  };
});
</script>
</script></body>
</html>
