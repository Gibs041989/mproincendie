<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interventions - MPro Incendie</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>Interventions</h1>
        <div class="section">
            <h2>Client</h2>
            <label for="client">Sélectionner un client :</label>
            <select id="client" onchange="updateClient()">
                <option value="">-- Choisir un client --</option>
            </select>
            <div>
                <a href="nouveau_client.html">Ajouter un client</a>
            </div>
        </div>
        <div class="section">
            <h2>Type d'intervention</h2>
            <label for="intervention-type">Type :</label>
            <select id="intervention-type">
                <option value="">-- Choisir --</option>
                <option value="extincteurs">Extincteurs</option>
                <option value="baes">BAES</option>
                <option value="ria">RIA</option>
                <option value="desenfumage">Désenfumage</option>
                <option value="bon">Bon d'intervention</option>
            </select>
            <div>
                <button onclick="startIntervention()">Démarrer l'intervention</button>
            </div>
        </div>
        <div class="section">
            <h2>Brouillons</h2>
            <div id="brouillons"></div>
        </div>
        <div class="navigation">
            <a href="index.html">Retour au tableau de bord</a>
        </div>
    </div>
    <script>
        function loadClients() {
            const clients = JSON.parse(localStorage.getItem('clients')) || [];
            const clientSelect = document.getElementById('client');
            clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.name;
                option.textContent = client.name;
                clientSelect.appendChild(option);
            });
        }
        function updateClient() {
            const client = document.getElementById('client').value;
            if (client) {
                localStorage.setItem('currentClient', client);
            }
        }
        function startIntervention() {
            const type = document.getElementById('intervention-type').value;
            const client = document.getElementById('client').value;
            if (!client) {
                alert('Veuillez sélectionner un client.');
                return;
            }
            if (!type) {
                alert('Veuillez sélectionner un type d’intervention.');
                return;
            }
            if (type === 'bon') {
                window.location.href = 'bon_intervention.html';
            } else {
                window.location.href = `CRM_${type}.html`;
            }
        }
        function loadBrouillons() {
            const brouillons = JSON.parse(localStorage.getItem('brouillons')) || {};
            const brouillonsDiv = document.getElementById('brouillons');
            if (Object.keys(brouillons).length === 0) {
                brouillonsDiv.textContent = 'Aucun brouillon.';
                return;
            }
            for (const [key, data] of Object.entries(brouillons)) {
                const div = document.createElement('div');
                div.textContent = `Brouillon ${key} pour ${data.client}`;
                brouillonsDiv.appendChild(div);
            }
        }
        window.onload = () => {
            loadClients();
            loadBrouillons();
        };
    </script>
</body>
</html>